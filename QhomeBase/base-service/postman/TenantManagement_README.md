# Tenant Management API - Postman Collection

## Overview
This Postman collection provides comprehensive testing for the Tenant Management API, including CRUD operations, validation testing, and tenant deletion request workflows.

## Files
- `TenantManagementAPI.postman_collection.json` - Main API collection
- `TenantManagement_Environment.postman_environment.json` - Environment variables
- `TenantManagement_README.md` - This documentation

## Setup Instructions

### 1. Import Collection
1. Open Postman
2. Click "Import" button
3. Select `TenantManagementAPI.postman_collection.json`
4. Click "Import"

### 2. Import Environment
1. Click the gear icon (‚öôÔ∏è) in the top right
2. Click "Import"
3. Select `TenantManagement_Environment.postman_environment.json`
4. Click "Import"
5. Select "Tenant Management Environment" from the environment dropdown

### 3. Generate Test Tokens
**IMPORTANT**: Before running any tests, you need to generate valid JWT tokens from IAM service:

1. **Generate Regular User Token**:
   - Run "Generate Test Token" request in "1. Token Generation" folder
   - This will call IAM service and automatically set the `access_token` variable

2. **Generate Admin Token** (for deletion approvals):
   - Run "Generate Admin Token" request in "1. Token Generation" folder
   - This will call IAM service and automatically set the `admin_access_token` variable

### 4. Configure Environment Variables
Update the following variables in your environment:

| Variable | Description | Example Value |
|----------|-------------|---------------|
| `base_service_url` | Base service URL | `http://localhost:8081` |
| `iam_service_url` | IAM service URL | `http://localhost:8088` |
| `user_id` | Test user ID | `550e8400-e29b-41d4-a716-446655440000` |
| `tenant_id` | Test tenant ID | `550e8400-e29b-41d4-a716-446655440001` |
| `access_token` | JWT token for regular user | Auto-generated by IAM service |
| `admin_access_token` | JWT token for admin user | Auto-generated by IAM service |

## API Endpoints Covered

### Tenant CRUD Operations
- **POST** `/api/tenants` - Create new tenant
- **GET** `/api/tenants` - Get all tenants (with pagination/filtering)
- **GET** `/api/tenants/{id}` - Get tenant by ID
- **PUT** `/api/tenants/{id}` - Update tenant
- **DELETE** `/api/tenants/{id}` - Soft delete tenant

### Tenant Deletion Requests
- **POST** `/api/tenant-deletions` - Create deletion request
- **GET** `/api/tenant-deletions/{id}` - Get deletion request by ID
- **POST** `/api/tenant-deletions/{id}/approve` - Approve deletion request

## Test Scenarios

### 1. Valid Operations
- ‚úÖ Create tenant with valid data
- ‚úÖ Get all tenants
- ‚úÖ Get tenant by ID
- ‚úÖ Update tenant
- ‚úÖ Create deletion request
- ‚úÖ Approve deletion request

### 2. Validation Testing
- ‚ùå Create tenant with empty name
- ‚ùå Create tenant with invalid email format
- ‚ùå Create tenant with invalid phone number
- ‚ùå Create tenant with code containing spaces
- ‚ùå Create deletion request without reason
- ‚ùå Create deletion request with reason too long
- ‚ùå Approve deletion request with note too long

### 3. Error Scenarios
- ‚ùå Get non-existent tenant
- ‚ùå Update non-existent tenant
- ‚ùå Create tenant with duplicate code
- ‚ùå Unauthorized requests (no token)

### 4. Search & Filter
- üîç Search tenants by name
- üîç Search tenants by code
- üîç Filter tenants by status
- üîç Pagination support

## Request Examples

### Create Tenant
```json
{
  "code": "TENANT001",
  "name": "FPT Tower",
  "contact": "+84 123 456 789",
  "email": "contact@fpttower.com",
  "address": "123 Hoa Lac, Thach That, Ha Noi",
  "status": "ACTIVE",
  "description": "Premium office building in Hanoi"
}
```

### Create Deletion Request
```json
{
  "tenantId": "550e8400-e29b-41d4-a716-446655440000",
  "reason": "Tenant no longer needed due to contract termination"
}
```

### Approve Deletion Request
```json
{
  "note": "Approved after reviewing all requirements and ensuring no active dependencies"
}
```

## Validation Rules

### Tenant Creation
- `code`: Required, max 50 chars, alphanumeric + underscore/hyphen only
- `name`: Required, 2-100 chars
- `contact`: Optional, max 20 chars, phone number format
- `email`: Optional, valid email format, max 255 chars
- `address`: Optional, max 500 chars
- `status`: Optional, defaults to "ACTIVE"
- `description`: Optional, max 500 chars

### Deletion Request
- `tenantId`: Required, valid UUID
- `reason`: Required, max 500 chars
- `note`: Optional, max 500 chars (for approval)

## Response Codes

| Code | Description |
|------|-------------|
| 200 | OK - Success |
| 201 | Created - Resource created successfully |
| 400 | Bad Request - Validation error |
| 401 | Unauthorized - Missing or invalid token |
| 403 | Forbidden - Insufficient permissions |
| 404 | Not Found - Resource not found |
| 409 | Conflict - Duplicate resource (e.g., duplicate code) |
| 500 | Internal Server Error - Server error |

## Automated Testing

The collection includes automated tests that run after each request:

- Response time validation (< 5000ms)
- Content-Type validation
- Automatic variable extraction for chaining requests
- Error response validation

## Environment Variables

The collection automatically manages these variables:
- `tenant_id` - Extracted from create/update responses
- `deletion_request_id` - Extracted from deletion request responses
- `very_long_reason` - Generated for validation testing
- `very_long_note` - Generated for validation testing

## Usage Tips

1. **Start with Authentication**: Ensure you have valid JWT tokens before running tests
2. **Sequential Testing**: Run tests in order as they depend on previous responses
3. **Clean Data**: Use different tenant codes for each test run to avoid conflicts
4. **Monitor Logs**: Check server logs for detailed error information
5. **Environment Switching**: Use different environments for dev/staging/prod

## Troubleshooting

### Common Issues

1. **401 Unauthorized**
   - Check if `access_token` is set and valid
   - Verify token hasn't expired

2. **400 Bad Request**
   - Check request body format
   - Verify all required fields are present
   - Check validation rules

3. **404 Not Found**
   - Verify `tenant_id` is set correctly
   - Check if resource exists

4. **409 Conflict**
   - Use unique tenant codes
   - Check for existing resources

### Debug Steps

1. Check environment variables
2. Verify request headers
3. Validate JSON format
4. Check server logs
5. Test with minimal data first

## Support

For issues or questions:
- Check API documentation
- Review server logs
- Test with curl/other tools
- Contact development team
